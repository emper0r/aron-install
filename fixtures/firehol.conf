# Firehol configuration
version 5

CTIME="82.190.13.128/29 192.168.200.0/24 192.168.207.0/24"

LAN="10.0.0.0/8 172.16.0.0/16 192.168.0.0/16"

transparent_proxy 80 3129 "root proxy" inface eth1
transparent_proxy 80 3129 "root proxy" inface eth2
transparent_proxy 80 3129 "root proxy" inface eth3

FIREHOL_LOG_LEVEL=7

interface4 eth0 ethernet
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh http" accept src "${CTIME}"
        client all accept

interface4 eth1 lan
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http squid dns samba" accept src "${LAN}"
	    server custom squid-t tcp/3129 default accept src "${LAN}"
        client all accept

interface4 eth2 segreteria src "${LAN}"
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http squid dns samba" accept src "${LAN}"
	    server custom squid-t tcp/3129 default accept src "${LAN}"
        client all accept

interface4 eth3 discovery src "${LAN}"
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http squid dns samba" accept src "${LAN}"
	    server custom squid-t tcp/3129 default accept src "${LAN}"
        client all accept

MAC_ALLOW="`cat /etc/squid3/mac_allow`"
router4 lan-1-inet inface eth1 outface eth0 mac not "${MAC_ALLOW}"
        masquerade
        route all accept

MAC_ALLOW="`cat /etc/firehol/mac_allow`"
router4 lan-2-inet inface eth2 outface eth0 mac not "${MAC_ALLOW}"
        masquerade
        route all accept

MAC_ALLOW="`cat /etc/firehol/mac_allow`"
router4 lan-3-inet inface eth3 outface eth0
        masquerade
        route all accept mac "${MAC_ALLOW}"
