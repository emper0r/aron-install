# Firehol configuration
version 5

CTIME="82.190.13.128/29"
LAN="10.0.0.0/8 172.16.0.0/16 192.168.0.0/16"

transparent_proxy 80 3129 "root proxy" inface eth1 src "$LAN"
transparent_proxy 80 3129 "root proxy" inface eth2 src "$LAN"

FIREHOL_LOG_LEVEL=7

interface4 eth0 ethernet
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh http" accept src "$CTIME"
        client all accept

interface4 eth1 lan src "$LAN"
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http" accept
        #server custom dansguardian tcp/8080 default accept src "$LAN"
        server custom transparent tcp/3129 default accept src "$LAN"
        client all accept

interface4 eth2 lan src "$LAN"
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http" accept
        #server custom dansguardian tcp/8080 default accept src "$LAN"
        server custom transparent tcp/3129 default accept src "$LAN"
        client all accept

interface4 eth3 lan src "$LAN"
        UNMATCHED_INPUT_POLICY=DROP
        UNMATCHED_OUTPUT_POLICY=DROP
        UNMATCHED_FORWARD_POLICY=DROP
        FIREHOL_LOG_FREQUENCY="1/second"
        FIREHOL_LOG_BURST="1"
        policy drop
        protection strong 5/sec 5
        server ident reject with tcp-reset
        server "icmp ssh dhcp http" accept
        #server custom dansguardian tcp/8080 default accept src "$LAN"
        server custom transparent tcp/3129 default accept src "$LAN"
        client all accept

MAC_DENY="`cat /etc/squid3/mac_deny`"
router4 lan2inet inface eth1 outface eth0 mac not "${MAC_DENY}"
        masquerade
        route all accept
